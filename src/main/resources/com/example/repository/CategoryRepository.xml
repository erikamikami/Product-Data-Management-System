<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.repository.CategoryRepository">

<!--　parentCategoryを取得　-->
<select id="findParentCategory" resultType="String">
  SELECT category_name FROM category 
  WHERE parent_id IS NULL AND name_all IS NULL
  ORDER BY category_name ASC
</select>

<!-- parentCategoryの名前からparentIdを取得 -->
<select id="findParentIdByParentCategory" parameterType="String" resultType="Integer">
  SELECT id FROM category
  WHERE category_name = #{parentCategory}
  AND parent_id IS NULL
  AND name_all IS NULL
</select>

<!--　parentIdListからChildCategoryを取得　-->
<select id="findChildCategoryByParentCategoryId" parameterType="Integer" resultType="String">
  SELECT category_name FROM category
  WHERE parent_id IS NOT NULL 
  AND name_all IS NULL 
  AND parent_id IN
  <foreach item="item" index="index" collection="list" open="(" separator="," close=")">
    #{item}
  </foreach>
  ORDER BY category_name ASC
</select>

<!-- childCategoryの名前からchildIdを取得 -->
<select id="findChildIdByChildCategory" parameterType="String" resultType="Integer">
  SELECT id FROM category
  WHERE category_name = #{parentCategory}
  AND parent_id IS NOT NULL
  AND name_all IS NULL
</select>

<!-- ChildIdListからgrandCategoryを取得 -->
<select id="findGrandChildCategoryByChildCategoryId" parameterType="Integer" resultType="String">
  SELECT category_name FROM category
  WHERE parent_id IS NOT NULL 
  AND name_all IS NOT NULL
  AND parent_id IN
  <foreach collection="list" item="item" index="index" open="(" separator="," close=")">
    #{item}
  </foreach>
  ORDER BY category_name ASC
</select>

</mapper>
